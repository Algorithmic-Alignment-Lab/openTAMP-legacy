from IPython import embed as shell
import itertools
import random

SEED = 1234
NUM_PROBS = 5
WIDTH = 8
HEIGHT = 9
SIZE = 1
NUM_CANS = 2 # each can i starts at target i, so we must have NUM_CANS <= NUM_TARGETS
NUM_TARGETS = 3
GOAL = "(At can0 target1), (At can1 target0)"

def main():
    random.seed(SEED)
    for iteration in range(NUM_PROBS):
        s = "# AUTOGENERATED. DO NOT EDIT.\n# Configuration file for NAMO problem instance. Blank lines and lines beginning with # are filtered out.\n\n"
        coords = list(itertools.product(range(HEIGHT), range(WIDTH)))
        random.shuffle(coords)
        coord_ind = 0
        s += "# The values after each attribute name are the values that get passed into the __init__ method for that attribute's class defined in the domain configuration.\n"
        s += "Objects: "
        for i in range(NUM_TARGETS):
            s += "Target (name target%d); "%(i)
            s += "RobotPose (name pdp_target%d); "%i
            if i < NUM_CANS:
                s += "Can (name can%d); "%i
                # s += "RobotPose (name gp_can%d); "%i
        s += "Robot (name %s); "%"pr2"
        s += "Grasp (name {}); ".format("grasp0")
        s += "RobotPose (name %s) \n\n"%"robot_init_pose"


        s += "Init: "
        for i in range(NUM_TARGETS):
            s += "(geom target%d 1), (pose target%d %s), "%(i, i, list(coords[i]))
            s += "(value pdp_target%d undefined), "%i
        for i in range(NUM_CANS):
            s += "(geom can%d 1), (pose can%d %s), "%(i, i, list(coords[i]))
            # s += "(value gp_can%d undefined), "%i
        s += "(value grasp0 undefined), "
        s += "(geom %s 1), (pose %s %s), "%("pr2", "pr2", list(coords[NUM_TARGETS]))
        s += "(pose pr2 {}), ".format(list(coords[NUM_TARGETS]))
        s += "(value %s %s); "%("robot_init_pose", list(coords[NUM_TARGETS]))
        for i in range(NUM_CANS):
            s += "(At can{} target{}), ".format(i, i)
            s += "(Stationary can{}), ".format(i)
            for j in range(NUM_CANS):
                s += "(StationaryNEq can{} can{}), ".format(i, j)
            # s += "(InContact pr2 gp_can{} target{}), ".format(i, i)
            # s += "(GraspValid gp_can{} target{} grasp0), ".format(i, i)
        for i in range(NUM_TARGETS):
            s += "(InContact pr2 pdp_target{} target{}), ".format(i, i)
            s += "(GraspValid pdp_target{} target{} grasp0), ".format(i, i)

        s += "(RobotAt pr2 robot_init_pose)\n\n"
        s += "Goal: %s"%GOAL

        with open("namo_probs/namo_%d_%d.prob"%(SEED, iteration), "w") as f:
            f.write(s)

if __name__ == "__main__":
    main()
